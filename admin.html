<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - KB MEDIC</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Admin Styles */
        .admin-main-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .admin-page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #eee; }
        .admin-page-header h1 { font-size: 1.5rem; color: #333; display: flex; align-items: center; gap: 10px; }
        .admin-page-header .header-actions { display: flex; gap: 10px; }
        
        /* Tab Navigation */
        .main-tabs { display: flex; gap: 8px; margin-bottom: 25px; flex-wrap: wrap; }
        .main-tab { padding: 14px 28px; border: none; background: #fff; border-radius: 10px; cursor: pointer; font-size: 0.95rem; font-weight: 600; color: #666; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 8px; }
        .main-tab:hover { background: #f8f8f8; transform: translateY(-2px); }
        .main-tab.active { background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4); }
        .main-tab .tab-badge { background: rgba(255,255,255,0.3); padding: 2px 10px; border-radius: 12px; font-size: 0.8rem; }
        .main-tab.active .tab-badge { background: rgba(255,255,255,0.2); }
        
        /* Tab Content */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
        .stat-card.products::before { background: linear-gradient(90deg, #0ea5e9, #0284c7); }
        .stat-card.orders::before { background: linear-gradient(90deg, #22c55e, #16a34a); }
        .stat-card.customers::before { background: linear-gradient(90deg, #a855f7, #7c3aed); }
        .stat-card.messages::before { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .stat-card .stat-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 1.4rem; }
        .stat-card.products .stat-icon { background: rgba(14, 165, 233, 0.1); color: #0ea5e9; }
        .stat-card.orders .stat-icon { background: rgba(34, 197, 94, 0.1); color: #22c55e; }
        .stat-card.customers .stat-icon { background: rgba(168, 85, 247, 0.1); color: #a855f7; }
        .stat-card.messages .stat-icon { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .stat-number { font-size: 2rem; font-weight: 700; color: #333; }
        .stat-label { font-size: 0.9rem; color: #666; margin-top: 5px; }
        
        /* Form Styles */
        .admin-form-card { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .admin-form-card h2 { font-size: 1.2rem; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0; display: flex; align-items: center; gap: 10px; }
        .form-section { margin-bottom: 25px; }
        .form-section-title { font-size: 0.9rem; font-weight: 600; color: #0ea5e9; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; transition: all 0.3s; box-sizing: border-box; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: #0ea5e9; outline: none; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; font-size: 0.9rem; }
        .form-actions { display: flex; gap: 15px; margin-top: 25px; padding-top: 20px; border-top: 2px solid #f0f0f0; flex-wrap: wrap; }
        .form-actions button { flex: 1; min-width: 150px; padding: 14px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-cancel { background: #f0f0f0; color: #666; }
        .btn-cancel:hover { background: #e0e0e0; }
        .btn-primary { background: #0ea5e9; color: white; }
        .btn-primary:hover { background: #0284c7; }
        .btn-success { background: #22c55e; color: white; }
        .btn-success:hover { background: #16a34a; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        
        /* Image Preview */
        .image-preview-container { display: flex; align-items: center; gap: 15px; }
        .image-preview { width: 80px; height: 80px; border-radius: 8px; border: 2px dashed #ddd; display: flex; align-items: center; justify-content: center; overflow: hidden; background: #f8f8f8; flex-shrink: 0; }
        .image-preview img { width: 100%; height: 100%; object-fit: cover; }
        .image-preview .placeholder { color: #999; font-size: 0.75rem; text-align: center; }
        .help-text { font-size: 0.75rem; color: #888; margin-top: 5px; line-height: 1.5; }
        
        /* Search Box */
        .search-box { position: relative; margin-bottom: 20px; }
        .search-box input { width: 100%; padding: 12px 15px 12px 45px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; box-sizing: border-box; }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999; }
        [dir="rtl"] .search-box i { left: auto; right: 15px; }
        
        /* Tables */
        .data-table-container { background: #fff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
        .data-table { width: 100%; overflow-x: auto; }
        .data-table table { width: 100%; border-collapse: collapse; }
        .data-table th { text-align: right; padding: 15px; background: #f8f8f8; font-size: 0.85rem; font-weight: 600; color: #666; border-bottom: 2px solid #e0e0e0; white-space: nowrap; }
        [dir="ltr"] .data-table th { text-align: left; }
        .data-table td { padding: 15px; border-bottom: 1px solid #f0f0f0; font-size: 0.9rem; vertical-align: middle; }
        .data-table tr:hover { background: #f8f8f8; }
        
        /* Product Cell */
        .product-cell { display: flex; align-items: center; gap: 12px; min-width: 200px; }
        .product-thumb { width: 50px; height: 50px; border-radius: 8px; overflow: hidden; background: #f0f0f0; flex-shrink: 0; }
        .product-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .product-info { min-width: 0; }
        .product-name { font-weight: 600; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-category { font-size: 0.8rem; color: #0ea5e9; margin-top: 2px; }
        
        /* Badges */
        .badge-cell { display: inline-block; padding: 4px 10px; font-size: 0.75rem; font-weight: 600; border-radius: 4px; white-space: nowrap; }
        .badge-new { background: #0ea5e9; color: white; }
        .badge-sale { background: #e74c3c; color: white; }
        .badge-popular { background: #f59e0b; color: white; }
        .badge-none { background: #f0f0f0; color: #999; }
        .badge-active { background: #dcfce7; color: #16a34a; }
        .badge-inactive { background: #fee2e2; color: #dc2626; }
        
        /* Order Status */
        .order-badge { display: inline-block; padding: 5px 12px; font-size: 0.8rem; font-weight: 600; border-radius: 20px; white-space: nowrap; }
        .order-badge.pending { background: #fef3c7; color: #d97706; }
        .order-badge.processing { background: #dbeafe; color: #2563eb; }
        .order-badge.shipped { background: #e0e7ff; color: #4f46e5; }
        .order-badge.delivered { background: #dcfce7; color: #16a34a; }
        .order-badge.cancelled { background: #fee2e2; color: #dc2626; }
        
        /* Actions */
        .actions-cell { display: flex; gap: 8px; flex-wrap: wrap; }
        .action-btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 500; transition: all 0.3s; display: inline-flex; align-items: center; gap: 5px; }
        .action-btn:hover { transform: translateY(-2px); }
        .btn-edit { background: #0ea5e9; color: white; }
        .btn-edit:hover { background: #0284c7; }
        .btn-delete { background: #ef4444; color: white; }
        .btn-delete:hover { background: #dc2626; }
        .btn-view { background: #8b5cf6; color: white; }
        .btn-view:hover { background: #7c3aed; }
        .btn-process { background: #22c55e; color: white; }
        .btn-process:hover { background: #16a34a; }
        .btn-ship { background: #6366f1; color: white; }
        .btn-ship:hover { background: #4f46e5; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state i { font-size: 4rem; margin-bottom: 20px; opacity: 0.3; }
        .empty-state h3 { color: #333; margin-bottom: 10px; }
        
        /* Filters */
        .filters-section { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .filters-row { display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; align-items: center; gap: 10px; }
        .filter-group label { font-weight: 500; color: #333; font-size: 0.9rem; }
        .filter-group select, .filter-group input { padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.9rem; min-width: 150px; }
        .filter-group select:focus, .filter-group input:focus { border-color: #0ea5e9; outline: none; }
        
        /* Order Stats */
        .order-stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .order-stat-box { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center; }
        .order-stat-box.pending { border-top: 3px solid #f59e0b; }
        .order-stat-box.processing { border-top: 3px solid #3b82f6; }
        .order-stat-box.shipped { border-top: 3px solid #8b5cf6; }
        .order-stat-box.delivered { border-top: 3px solid #22c55e; }
        .order-stat-box.cancelled { border-top: 3px solid #ef4444; }
        .order-stat-number { font-size: 1.5rem; font-weight: 700; color: #333; }
        .order-stat-label { font-size: 0.85rem; color: #666; margin-top: 3px; }
        
        /* Customer Info */
        .customer-info { display: flex; align-items: center; gap: 12px; }
        .customer-avatar { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.1rem; flex-shrink: 0; }
        .customer-details { display: flex; flex-direction: column; }
        .customer-name { font-weight: 600; color: #333; }
        .customer-email { font-size: 0.85rem; color: #666; }
        
        /* Messages */
        .messages-list { display: flex; flex-direction: column; gap: 15px; }
        .message-card { background: #fff; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; transition: all 0.3s; }
        .message-card:hover { box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
        .message-card.unread { border-right: 4px solid #f59e0b; }
        .message-card.read { border-right: 4px solid #0ea5e9; }
        .message-header { display: flex; justify-content: space-between; align-items: flex-start; padding: 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; flex-wrap: wrap; gap: 15px; }
        .message-sender { display: flex; align-items: center; gap: 15px; }
        .sender-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem; flex-shrink: 0; }
        .sender-info h4 { margin: 0 0 5px 0; color: #1e293b; font-size: 1rem; }
        .sender-info p { margin: 0; color: #64748b; font-size: 0.85rem; }
        .message-meta { text-align: left; }
        .message-date { color: #94a3b8; font-size: 0.85rem; }
        .message-status { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; margin-top: 5px; }
        .message-status.unread { background: #fef3c7; color: #d97706; }
        .message-status.read { background: #dbeafe; color: #2563eb; }
        .message-body { padding: 20px; }
        .message-subject { font-size: 1.1rem; font-weight: 600; color: #1e293b; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .message-subject i { color: #0ea5e9; }
        .message-content { color: #475569; line-height: 1.8; font-size: 0.95rem; white-space: pre-wrap; }
        .message-actions { padding: 15px 20px; background: #f8fafc; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end; }
        
        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: white; border-radius: 16px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px; border-bottom: 2px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 1.2rem; color: #333; margin: 0; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; padding: 5px; }
        .modal-close:hover { color: #333; }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 20px; border-top: 2px solid #f0f0f0; display: flex; justify-content: flex-end; gap: 10px; flex-wrap: wrap; }
        
        /* Toast */
        .admin-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); padding: 15px 30px; border-radius: 8px; display: flex; align-items: center; gap: 10px; z-index: 1000; opacity: 0; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .admin-toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .admin-toast.success { background: #27ae60; color: white; }
        .admin-toast.error { background: #e74c3c; color: white; }
        
        /* Layout Grid for Products */
        .admin-layout { display: grid; grid-template-columns: 1fr 1.5fr; gap: 25px; }
        @media (max-width: 1024px) { .admin-layout { grid-template-columns: 1fr; } }
        
        /* Back Link */
        .back-link { display: flex; align-items: center; gap: 8px; color: #0ea5e9; font-weight: 500; text-decoration: none; font-size: 0.95rem; }
        .back-link:hover { text-decoration: underline; }
        
        /* Loading Spinner */
        .loading-spinner { display: flex; justify-content: center; align-items: center; padding: 40px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #0ea5e9; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Auth Overlay */
        #authOverlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f8fafc; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; font-family: 'Cairo', sans-serif; }
        #authOverlay.show { display: flex; }
        #authOverlay i { font-size: 4rem; color: #f59e0b; margin-bottom: 20px; }
        #authOverlay h2 { color: #333; margin-bottom: 10px; }
        #authOverlay p { color: #666; margin-bottom: 30px; }
        #authOverlay a { background: #0ea5e9; color: white; padding: 15px 40px; border-radius: 10px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 10px; }
        
        /* Detail Section in Modal */
        .detail-section { margin-bottom: 20px; }
        .detail-section h4 { font-size: 1rem; color: #0ea5e9; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 8px; }
        .detail-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #f0f0f0; flex-wrap: wrap; gap: 10px; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { color: #666; font-size: 0.9rem; }
        .detail-value { font-weight: 600; color: #333; }
        
        /* Items List */
        .items-list { background: #f8fafc; border-radius: 10px; padding: 15px; }
        .item-row { display: flex; align-items: center; gap: 15px; padding: 12px 0; border-bottom: 1px solid #e2e8f0; flex-wrap: wrap; }
        .item-row:last-child { border-bottom: none; }
        .item-img { width: 60px; height: 60px; border-radius: 8px; overflow: hidden; flex-shrink: 0; }
        .item-img img { width: 100%; height: 100%; object-fit: cover; }
        .item-info { flex: 1; min-width: 150px; }
        .item-name { font-weight: 600; color: #333; margin-bottom: 5px; }
        .item-qty { font-size: 0.85rem; color: #666; }
        .item-price { font-weight: 700; color: #0ea5e9; }
        .total-row { display: flex; justify-content: space-between; padding: 15px; background: #f8fafc; border-radius: 10px; margin-top: 15px; flex-wrap: wrap; gap: 10px; }
        .total-label { font-weight: 700; font-size: 1.1rem; color: #333; }
        .total-value { font-weight: 700; font-size: 1.2rem; color: #0ea5e9; }
        
        /* Message Filters */
        .message-filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .message-filter-btn { padding: 8px 16px; border: 2px solid #e2e8f0; background: white; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500; color: #64748b; transition: all 0.3s; }
        .message-filter-btn:hover { border-color: #0ea5e9; color: #0ea5e9; }
        .message-filter-btn.active { background: #0ea5e9; border-color: #0ea5e9; color: white; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .admin-page-header { flex-direction: column; gap: 15px; text-align: center; }
            .main-tabs { justify-content: center; }
            .main-tab { padding: 12px 20px; font-size: 0.85rem; }
            .form-row { grid-template-columns: 1fr; }
            .filters-row { flex-direction: column; align-items: stretch; }
            .filter-group { flex-direction: column; align-items: stretch; }
            .filter-group select, .filter-group input { width: 100%; }
            .actions-cell { justify-content: center; }
            .modal-content { width: 95%; margin: 10px; }
        }
    </style>
</head>
<body>
    <!-- Auth Overlay -->
    <div id="authOverlay">
        <i class="fas fa-exclamation-triangle"></i>
        <h2>ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <p>ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</p>
        <a href="admin-login.html"><i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</a>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-content">
                <span class="announcement"><i class="fas fa-truck"></i> ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 5000 Ø¯Ø¬</span>
                <div class="top-bar-actions">
                    <button class="lang-switch" onclick="toggleAdminLanguage()">
                        <span class="lang-ar active">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                        <span class="separator">|</span>
                        <span class="lang-fr">FranÃ§ais</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <span class="logo-icon"><i class="fas fa-plus-square"></i></span>
                        <span class="logo-text">KB <span class="highlight">MEDIC</span></span>
                    </a>
                </div>

                <div class="search-bar">
                    <input type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
                    <button class="search-btn"><i class="fas fa-search"></i></button>
                </div>

                <div class="header-actions">
                    <div class="cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </div>
                    <div class="admin-logout" style="margin-right: 15px;">
                        <button onclick="adminLogout()" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Ø®Ø±ÙˆØ¬</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav">
        <div class="container">
            <ul class="nav-menu">
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="index.html#products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                <li><a href="index.html#contact">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Admin Content -->
    <main class="admin-main-container">
        <div class="admin-page-header">
            <h1><i class="fas fa-cogs"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h1>
            <div class="header-actions">
                <button class="action-btn btn-view" onclick="loadAllData()">
                    <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                </button>
                <a href="index.html" class="back-link">
                    <i class="fas fa-home"></i>
                    <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</span>
                </a>
            </div>
        </div>

        <!-- Main Tabs -->
        <div class="main-tabs">
            <button class="main-tab active" onclick="switchMainTab('products')">
                <i class="fas fa-box-open"></i>
                Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                <span class="tab-badge" id="productsCount">0</span>
            </button>
            <button class="main-tab" onclick="switchMainTab('orders')">
                <i class="fas fa-shopping-bag"></i>
                Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                <span class="tab-badge" id="ordersCount">0</span>
            </button>
            <button class="main-tab" onclick="switchMainTab('customers')">
                <i class="fas fa-users"></i>
                Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                <span class="tab-badge" id="customersCount">0</span>
            </button>
            <button class="main-tab" onclick="switchMainTab('messages')">
                <i class="fas fa-envelope"></i>
                Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                <span class="tab-badge" id="unreadMessagesCount">0</span>
            </button>
        </div>

        <!-- Products Tab -->
        <div class="tab-content active" id="productsTab">
            <!-- Products Stats -->
            <div class="stats-grid">
                <div class="stat-card products">
                    <div class="stat-icon"><i class="fas fa-box"></i></div>
                    <div class="stat-number" id="totalProducts">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                </div>
                <div class="stat-card orders">
                    <div class="stat-icon"><i class="fas fa-tag"></i></div>
                    <div class="stat-number" id="onSaleProducts">0</div>
                    <div class="stat-label">Ù…Ù†ØªØ¬Ø§Øª Ù…Ø®ÙØ¶Ø©</div>
                </div>
                <div class="stat-card customers">
                    <div class="stat-icon"><i class="fas fa-star"></i></div>
                    <div class="stat-number" id="newProducts">0</div>
                    <div class="stat-label">Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
                </div>
            </div>

            <div class="admin-layout">
                <!-- Add/Edit Form -->
                <div class="admin-form-card">
                    <h2><i class="fas fa-plus-circle"></i> <span id="productFormTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</span></h2>
                    
                    <form id="productForm">
                        <input type="hidden" id="productId">

                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-tag"></i>
                                <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</span>
                            </div>
                            
                            <div class="form-group">
                                <input type="text" id="productName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© *" required>
                            </div>
                            <div class="form-group">
                                <input type="text" id="productNameFr" placeholder="Nom en franÃ§ais *" required>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-folder"></i>
                                <span>Ø§Ù„ØªØµÙ†ÙŠÙ</span>
                            </div>
                            
                            <div class="form-group">
                                <select id="productCategory" required>
                                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ --</option>
                                    <option value="medicines">Ø§Ù„Ø£Ø¯ÙˆÙŠØ© - MÃ©dicaments</option>
                                    <option value="equipment">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© - Ã‰quipements</option>
                                    <option value="beauty">Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„ - CosmÃ©tiques</option>
                                    <option value="personal_care">Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ© - HygiÃ¨ne</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ø¯Ø¬)</label>
                                <input type="number" id="productPrice" placeholder="500" min="0">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø¯Ø¬)</label>
                                <input type="number" id="productOriginalPrice" placeholder="600" min="0">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (0-5)</label>
                                <input type="number" id="productRating" placeholder="4" min="0" max="5" step="0.5" value="4">
                            </div>
                            <div class="form-group">
                                <label>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</label>
                                <input type="number" id="productReviews" placeholder="0" min="0" value="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©</label>
                            <select id="productBadge">
                                <option value="">-- Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© --</option>
                                <option value="new">ğŸ†• Ø¬Ø¯ÙŠØ¯</option>
                                <option value="sale">ğŸ”¥ Ø®ØµÙ…</option>
                                <option value="popular">â­ Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</option>
                            </select>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-image"></i>
                                <span>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</span>
                            </div>
                            <div class="form-group">
                                <input type="url" id="productImage" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (https://...)" required>
                                <div class="image-preview-container" style="margin-top: 10px;">
                                    <div class="image-preview" id="imagePreview">
                                        <span class="placeholder">Ù…Ø¹Ø§ÙŠÙ†Ø©</span>
                                    </div>
                                    <div style="flex: 1;">
                                        <div class="help-text">Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Google Images</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-align-right"></i>
                                <span>Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
                            </div>
                            <div class="form-group">
                                <textarea id="productDescription" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©..." rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <textarea id="productDescriptionFr" placeholder="Description en franÃ§ais..." rows="3"></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-cancel" onclick="resetProductForm()">
                                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                            </button>
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Products List -->
                <div class="admin-form-card">
                    <h2><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
                    
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchProducts" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." onkeyup="searchProducts()">
                    </div>

                    <div class="data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th style="min-width: 200px;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th style="min-width: 100px;">Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                                    <th style="min-width: 70px;">Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</th>
                                    <th style="min-width: 80px;">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                            </tbody>
                        </table>
                    </div>

                    <div class="empty-state" id="productsEmptyState" style="display: none;">
                        <i class="fas fa-box-open"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>
                        <p>Ø£Ø¶Ù Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div class="tab-content" id="ordersTab">
            <!-- Order Stats -->
            <div class="order-stats-row">
                <div class="order-stat-box pending">
                    <div class="order-stat-number" id="orderStatPending">0</div>
                    <div class="order-stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="order-stat-box processing">
                    <div class="order-stat-number" id="orderStatProcessing">0</div>
                    <div class="order-stat-label">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±</div>
                </div>
                <div class="order-stat-box shipped">
                    <div class="order-stat-number" id="orderStatShipped">0</div>
                    <div class="order-stat-label">ØªÙ… Ø§Ù„Ø´Ø­Ù†</div>
                </div>
                <div class="order-stat-box delivered">
                    <div class="order-stat-number" id="orderStatDelivered">0</div>
                    <div class="order-stat-label">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</div>
                </div>
                <div class="order-stat-box cancelled">
                    <div class="order-stat-number" id="orderStatCancelled">0</div>
                    <div class="order-stat-label">Ù…Ù„ØºÙ‰</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-section">
                <div class="filters-row">
                    <div class="filter-group">
                        <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                        <select id="orderStatusFilter" onchange="filterOrders()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="processing">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±</option>
                            <option value="shipped">ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                            <option value="delivered">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</option>
                            <option value="cancelled">Ù…Ù„ØºÙ‰</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Ø¨Ø­Ø«:</label>
                        <input type="text" id="orderSearch" placeholder="Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨..." onkeyup="filterOrders()">
                    </div>
                </div>
            </div>

            <!-- Orders Table -->
            <div class="data-table-container">
                <div id="ordersLoading" class="loading-spinner" style="display: none;">
                    <div class="spinner"></div>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                        </tbody>
                    </table>
                </div>

                <div class="empty-state" id="ordersEmptyState" style="display: none;">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h3>
                    <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>
                </div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div class="tab-content" id="customersTab">
            <!-- Customer Stats -->
            <div class="stats-grid">
                <div class="stat-card customers">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-number" id="totalCustomers">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                </div>
                <div class="stat-card products">
                    <div class="stat-icon"><i class="fas fa-user-check"></i></div>
                    <div class="stat-number" id="activeCustomers">0</div>
                    <div class="stat-label">Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙŠÙ†</div>
                </div>
                <div class="stat-card orders">
                    <div class="stat-icon"><i class="fas fa-shopping-bag"></i></div>
                    <div class="stat-number" id="totalOrders">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                </div>
                <div class="stat-card messages">
                    <div class="stat-icon"><i class="fas fa-coins"></i></div>
                    <div class="stat-number" id="totalSales">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø¯Ø¬)</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-section">
                <div class="filters-row">
                    <div class="filter-group">
                        <label>Ø¨Ø­Ø«:</label>
                        <input type="text" id="customerSearch" placeholder="Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ..." onkeyup="filterCustomers()">
                    </div>
                    <div class="filter-group">
                        <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                        <select id="customerStatusFilter" onchange="filterCustomers()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="active">Ù†Ø´Ø·</option>
                            <option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Customers Table -->
            <div class="data-table-container">
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th style="min-width: 220px;">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th style="min-width: 130px;">Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th style="min-width: 100px;">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</th>
                                <th style="min-width: 100px;">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</th>
                                <th style="min-width: 80px;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th style="min-width: 150px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th style="min-width: 150px;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="customersTableBody">
                        </tbody>
                    </table>
                </div>

                <div class="empty-state" id="customersEmptyState" style="display: none;">
                    <i class="fas fa-users"></i>
                    <h3>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</h3>
                    <p>Ù„Ù… ÙŠØ³Ø¬Ù„ Ø£ÙŠ Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø¹Ø¯</p>
                </div>
            </div>
        </div>

        <!-- Messages Tab -->
        <div class="tab-content" id="messagesTab">
            <!-- Messages Stats -->
            <div class="stats-grid">
                <div class="stat-card messages">
                    <div class="stat-icon"><i class="fas fa-envelope"></i></div>
                    <div class="stat-number" id="totalMessages">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                </div>
                <div class="stat-card orders">
                    <div class="stat-icon"><i class="fas fa-envelope-open"></i></div>
                    <div class="stat-number" id="readMessages">0</div>
                    <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
                </div>
                <div class="stat-card products">
                    <div class="stat-icon"><i class="fas fa-envelope"></i></div>
                    <div class="stat-number" id="unreadMessages">0</div>
                    <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
                </div>
            </div>

            <!-- Messages Filters -->
            <div class="filters-section">
                <div class="message-filters">
                    <button class="message-filter-btn active" onclick="filterMessages('all', this)">Ø§Ù„ÙƒÙ„</button>
                    <button class="message-filter-btn" onclick="filterMessages('unread', this)">ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©</button>
                    <button class="message-filter-btn" onclick="filterMessages('read', this)">Ù…Ù‚Ø±ÙˆØ¡Ø©</button>
                </div>
            </div>

            <!-- Messages List -->
            <div class="data-table-container">
                <div class="messages-list" id="messagesList">
                </div>

                <div class="empty-state" id="messagesEmptyState" style="display: none;">
                    <i class="fas fa-envelope-open"></i>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</h3>
                    <p>Ù„Ù… ØªØµÙ„ Ø£ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§ØªØµØ§Ù„</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Order Details Modal -->
    <div id="orderModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" onclick="closeOrderModal()">&times;</button>
            </div>
            <div class="modal-body" id="orderModalBody">
            </div>
            <div class="modal-footer">
                <button class="action-btn btn-danger" id="modalCancelBtn" onclick="cancelOrderFromModal()" style="display: none;">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="action-btn btn-ship" id="modalShipBtn" onclick="shipOrderFromModal()" style="display: none;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</button>
                <button class="action-btn btn-process" id="modalDeliverBtn" onclick="deliverOrderFromModal()" style="display: none;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</button>
                <button class="action-btn btn-view" onclick="closeOrderModal()" style="background: #6b7280;">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="admin-toast" id="adminToast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom" style="justify-content: center;">
                <p>&copy; 2025 KB MEDIC. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            </div>
        </div>
    </footer>

    <script>
        // ===============================
        // Configuration & State
        // ===============================
        const API_BASE = '/api';
        const ADMIN_SESSION_KEY = 'kbMedicAdmin';
        const AUTH_TOKEN_KEY = 'auth_token';
        const SESSION_TIMEOUT = 8 * 60 * 60 * 1000;
        
        // Storage Keys
        const PRODUCTS_KEY = 'kb_medic_products';
        const ORDERS_KEY = 'kbMedicOrders';
        const CUSTOMERS_KEY = 'kbMedicCustomers';
        const MESSAGES_KEY = 'kbMedicMessages';
        
        // State
        let allProducts = [];
        let allOrders = [];
        let allCustomers = [];
        let allMessages = [];
        let filteredOrders = [];
        let filteredCustomers = [];
        let currentMessageFilter = 'all';
        let selectedOrder = null;
        let editingProductId = null;
        let currentLang = 'ar';
        
        // Category Map
        const categoryMap = {
            'medicines': { ar: 'Ø§Ù„Ø£Ø¯ÙˆÙŠØ©', fr: 'MÃ©dicaments' },
            'equipment': { ar: 'Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©', fr: 'Ã‰quipements' },
            'beauty': { ar: 'Ø§Ù„ØªØ¬Ù…ÙŠÙ„', fr: 'CosmÃ©tiques' },
            'personal_care': { ar: 'Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ©', fr: 'HygiÃ¨ne' }
        };

        // ===============================
        // Initialization
        // ===============================
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadAllData();
            setupProductForm();
            setupImagePreview();
            updateCartCount();
        });

        // Check Authentication
        async function checkAuth() {
            const token = localStorage.getItem(AUTH_TOKEN_KEY);
            const session = localStorage.getItem(ADMIN_SESSION_KEY);
            
            if (!token || !session) {
                showAuthOverlay();
                return false;
            }
            
            try {
                const sessionData = JSON.parse(session);
                if (Date.now() > sessionData.expiresAt) {
                    logout();
                    return false;
                }
                
                // Verify with server if possible
                try {
                    const response = await fetch('/api/auth/verify', {
                        method: 'GET',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    if (!response.ok) throw new Error('Invalid token');
                } catch (e) {
                    console.log('Using local session');
                }
                
                hideAuthOverlay();
                return true;
            } catch (e) {
                logout();
                return false;
            }
        }

        function showAuthOverlay() {
            document.getElementById('authOverlay').classList.add('show');
        }

        function hideAuthOverlay() {
            document.getElementById('authOverlay').classList.remove('show');
        }

        function logout() {
            localStorage.removeItem(AUTH_TOKEN_KEY);
            localStorage.removeItem(ADMIN_SESSION_KEY);
            window.location.href = 'admin-login.html';
        }

        function adminLogout() {
            localStorage.removeItem(AUTH_TOKEN_KEY);
            localStorage.removeItem(ADMIN_SESSION_KEY);
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'success');
            setTimeout(() => {
                window.location.href = 'admin-login.html';
            }, 1000);
        }

        // ===============================
        // Data Loading
        // ===============================
        async function loadAllData() {
            loadProducts();
            loadOrders();
            loadCustomers();
            loadMessages();
        }

        function loadProducts() {
            const stored = localStorage.getItem(PRODUCTS_KEY);
            allProducts = stored ? JSON.parse(stored) : [];
            renderProductsTable();
            updateProductsStats();
        }

        async function loadOrders() {
            try {
                const response = await fetch(`${API_BASE}/orders`);
                if (response.ok) {
                    const data = await response.json();
                    allOrders = data.orders || [];
                } else {
                    throw new Error('API not available');
                }
            } catch (e) {
                const stored = localStorage.getItem(ORDERS_KEY);
                allOrders = stored ? JSON.parse(stored) : [];
            }
            renderOrders();
            updateOrdersStats();
        }

        function loadCustomers() {
            const stored = localStorage.getItem(CUSTOMERS_KEY);
            allCustomers = stored ? JSON.parse(stored) : [];
            renderCustomers();
            updateCustomersStats();
        }

        function loadMessages() {
            const stored = localStorage.getItem(MESSAGES_KEY);
            allMessages = stored ? JSON.parse(stored) : [];
            renderMessages();
            updateMessagesStats();
        }

        function saveProducts() {
            localStorage.setItem(PRODUCTS_KEY, JSON.stringify(allProducts));
            window.dispatchEvent(new CustomEvent('productsUpdated', { detail: allProducts }));
        }

        function saveOrders() {
            localStorage.setItem(ORDERS_KEY, JSON.stringify(allOrders));
        }

        // ===============================
        // Tab Navigation
        // ===============================
        function switchMainTab(tabName) {
            document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.main-tab[onclick="switchMainTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // ===============================
        // Products Section
        // ===============================
        function setupProductForm() {
            const form = document.getElementById('productForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveProduct();
                });
            }
        }

        function setupImagePreview() {
            const input = document.getElementById('productImage');
            if (input) {
                input.addEventListener('input', function(e) {
                    updateImagePreview(e.target.value);
                });
            }
        }

        function updateImagePreview(url) {
            const preview = document.getElementById('imagePreview');
            if (preview) {
                if (url && url.trim()) {
                    preview.innerHTML = `<img src="${url}" alt="Preview" onerror="this.parentElement.innerHTML='<span class=placeholder>Ù…Ø¹Ø§ÙŠÙ†Ø©</span>'">`;
                } else {
                    preview.innerHTML = '<span class="placeholder">Ù…Ø¹Ø§ÙŠÙ†Ø©</span>';
                }
            }
        }

        function renderProductsTable(filterText = '') {
            const tbody = document.getElementById('productsTableBody');
            const emptyState = document.getElementById('productsEmptyState');
            
            if (!tbody) return;
            
            let filtered = allProducts;
            if (filterText) {
                const filter = filterText.toLowerCase();
                filtered = allProducts.filter(p => {
                    const name = p.name || p.nameFr || '';
                    return name.toLowerCase().includes(filter);
                });
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tbody.innerHTML = filtered.map(product => {
                const name = currentLang === 'ar' ? product.name : product.nameFr;
                const category = categoryMap[product.category] ? (currentLang === 'ar' ? categoryMap[product.category].ar : categoryMap[product.category].fr) : product.category;
                const price = product.price ? product.price.toLocaleString() : '0';
                const badgeClass = product.badge === 'new' ? 'badge-new' :
                                   product.badge === 'sale' ? 'badge-sale' :
                                   product.badge === 'popular' ? 'badge-popular' : 'badge-none';
                const badgeText = getBadgeText(product.badge);
                
                return `<tr>
                    <td>
                        <div class="product-cell">
                            <div class="product-thumb">
                                <img src="${product.image}" alt="${name}" onerror="this.src='imgs/placeholder-small.svg'">
                            </div>
                            <div class="product-info">
                                <div class="product-name">${name}</div>
                                <div class="product-category">${category}</div>
                            </div>
                        </div>
                    </td>
                    <td><strong>${price} Ø¯Ø¬</strong></td>
                    <td>${category}</td>
                    <td><span class="badge-cell ${badgeClass}">${badgeText}</span></td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn btn-edit" onclick="editProduct(${product.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteProduct(${product.id})" title="Ø­Ø°Ù">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }

        function searchProducts() {
            const searchInput = document.getElementById('searchProducts');
            renderProductsTable(searchInput ? searchInput.value : '');
        }

        function getBadgeText(badge) {
            if (!badge) return '-';
            const badges = { 'new': 'Ø¬Ø¯ÙŠØ¯', 'sale': 'Ø®ØµÙ…', 'popular': 'Ù…Ø¨ÙŠØ¹' };
            return badges[badge] || badge;
        }

        function updateProductsStats() {
            document.getElementById('totalProducts').textContent = allProducts.length;
            document.getElementById('onSaleProducts').textContent = allProducts.filter(p => p.badge === 'sale').length;
            document.getElementById('newProducts').textContent = allProducts.filter(p => p.badge === 'new').length;
            document.getElementById('productsCount').textContent = allProducts.length;
        }

        function saveProduct() {
            const productData = {
                id: editingProductId || Date.now(),
                name: document.getElementById('productName').value,
                nameFr: document.getElementById('productNameFr').value,
                category: document.getElementById('productCategory').value,
                categoryName: categoryMap[document.getElementById('productCategory').value]?.ar || '',
                categoryNameFr: categoryMap[document.getElementById('productCategory').value]?.fr || '',
                price: parseFloat(document.getElementById('productPrice').value) || 0,
                originalPrice: document.getElementById('productOriginalPrice').value ? parseFloat(document.getElementById('productOriginalPrice').value) : null,
                image: document.getElementById('productImage').value,
                badge: document.getElementById('productBadge').value || null,
                rating: parseFloat(document.getElementById('productRating').value) || 4,
                reviews: parseInt(document.getElementById('productReviews').value) || 0,
                description: document.getElementById('productDescription').value,
                descriptionFr: document.getElementById('productDescriptionFr').value
            };
            
            if (!productData.name || !productData.nameFr || !productData.category || !productData.image) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            if (editingProductId) {
                const idx = allProducts.findIndex(p => p.id === editingProductId);
                if (idx !== -1) {
                    allProducts[idx] = productData;
                }
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } else {
                allProducts.push(productData);
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
            
            saveProducts();
            renderProductsTable();
            updateProductsStats();
            resetProductForm();
        }

        function editProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;
            
            editingProductId = id;
            document.getElementById('productId').value = id;
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productNameFr').value = product.nameFr || '';
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('productPrice').value = product.price || '';
            document.getElementById('productOriginalPrice').value = product.originalPrice || '';
            document.getElementById('productBadge').value = product.badge || '';
            document.getElementById('productRating').value = product.rating || 4;
            document.getElementById('productReviews').value = product.reviews || 0;
            document.getElementById('productImage').value = product.image || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productDescriptionFr').value = product.descriptionFr || '';
            
            updateImagePreview(product.image);
            
            const btn = document.getElementById('submitBtn');
            if (btn) btn.innerHTML = '<i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬';
            
            document.getElementById('productFormTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
            document.querySelector('.admin-form-card').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;
            
            const name = product.name || product.nameFr;
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù "${name}"ØŸ`)) {
                allProducts = allProducts.filter(p => p.id !== id);
                saveProducts();
                renderProductsTable();
                updateProductsStats();
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        function resetProductForm() {
            editingProductId = null;
            const form = document.getElementById('productForm');
            if (form) form.reset();
            
            document.getElementById('productId').value = '';
            document.getElementById('productRating').value = 4;
            document.getElementById('productReviews').value = 0;
            updateImagePreview('');
            
            const btn = document.getElementById('submitBtn');
            if (btn) btn.innerHTML = '<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬';
            
            document.getElementById('productFormTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯';
        }

        // ===============================
        // Orders Section
        // ===============================
        function renderOrders() {
            const tbody = document.getElementById('ordersTableBody');
            const emptyState = document.getElementById('ordersEmptyState');
            const loading = document.getElementById('ordersLoading');
            
            if (loading) loading.style.display = 'none';
            
            if (!tbody) return;
            
            if (filteredOrders.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tbody.innerHTML = filteredOrders.map(order => `
                <tr>
                    <td><strong>${order.id}</strong></td>
                    <td>
                        <div class="customer-info">
                            <div class="customer-avatar" style="width: 35px; height: 35px; font-size: 0.9rem;">${(order.customerName || 'Ø¹').charAt(0)}</div>
                            <div class="customer-details">
                                <span class="customer-name">${order.customerName}</span>
                                <span class="customer-email">${order.customerPhone}</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div>
                            <p style="margin: 0; font-size: 0.9rem;">${order.items[0]?.name || 'Ù…Ù†ØªØ¬'}</p>
                            <small style="color: #666;">${order.items.length} Ù…Ù†ØªØ¬${order.items.length > 1 ? 'Ø§Øª' : ''}</small>
                        </div>
                    </td>
                    <td><strong>${order.total.toLocaleString()} Ø¯Ø¬</strong></td>
                    <td><span class="order-badge ${order.status}">${getOrderStatusText(order.status)}</span></td>
                    <td>${formatDate(order.createdAt)}</td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn btn-view" onclick="viewOrder('${order.id}')" title="Ø¹Ø±Ø¶">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${order.status === 'pending' ? `
                                <button class="action-btn btn-process" onclick="updateOrderStatus('${order.id}', 'processing')" title="ØªØ­Ø¶ÙŠØ±">
                                    <i class="fas fa-cog"></i>
                                </button>
                            ` : ''}
                            ${order.status === 'processing' ? `
                                <button class="action-btn btn-ship" onclick="updateOrderStatus('${order.id}', 'shipped')" title="Ø´Ø­Ù†">
                                    <i class="fas fa-truck"></i>
                                </button>
                            ` : ''}
                            ${order.status === 'shipped' ? `
                                <button class="action-btn btn-process" onclick="updateOrderStatus('${order.id}', 'delivered')" title="ØªÙˆØµÙŠÙ„">
                                    <i class="fas fa-check"></i>
                                </button>
                            ` : ''}
                            ${['pending', 'processing'].includes(order.status) ? `
                                <button class="action-btn btn-delete" onclick="cancelOrder('${order.id}')" title="Ø¥Ù„ØºØ§Ø¡">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filterOrders() {
            const statusFilter = document.getElementById('orderStatusFilter').value;
            const searchQuery = document.getElementById('orderSearch').value.toLowerCase();
            
            filteredOrders = allOrders.filter(order => {
                const matchesStatus = !statusFilter || order.status === statusFilter;
                const matchesSearch = !searchQuery || 
                    order.id.toLowerCase().includes(searchQuery) ||
                    order.customerName.toLowerCase().includes(searchQuery) ||
                    (order.customerPhone || '').includes(searchQuery);
                
                return matchesStatus && matchesSearch;
            });
            
            renderOrders();
        }

        function updateOrdersStats() {
            document.getElementById('orderStatPending').textContent = allOrders.filter(o => o.status === 'pending').length;
            document.getElementById('orderStatProcessing').textContent = allOrders.filter(o => o.status === 'processing').length;
            document.getElementById('orderStatShipped').textContent = allOrders.filter(o => o.status === 'shipped').length;
            document.getElementById('orderStatDelivered').textContent = allOrders.filter(o => o.status === 'delivered').length;
            document.getElementById('orderStatCancelled').textContent = allOrders.filter(o => o.status === 'cancelled').length;
            document.getElementById('ordersCount').textContent = allOrders.length;
            
            filteredOrders = [...allOrders];
        }

        function getOrderStatusText(status) {
            const statuses = {
                'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                'processing': 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±',
                'shipped': 'ØªÙ… Ø§Ù„Ø´Ø­Ù†',
                'delivered': 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',
                'cancelled': 'Ù…Ù„ØºÙ‰'
            };
            return statuses[status] || status;
        }

        function viewOrder(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            selectedOrder = order;
            const itemsHTML = order.items.map(item => `
                <div class="item-row">
                    <div class="item-img">
                        <img src="${item.image}" alt="${item.name}" onerror="this.src='imgs/placeholder-small.svg'">
                    </div>
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-qty">Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}</div>
                    </div>
                    <div class="item-price">${(item.price * item.quantity).toLocaleString()} Ø¯Ø¬</div>
                </div>
            `).join('');
            
            document.getElementById('orderModalBody').innerHTML = `
                <div class="detail-section">
                    <h4><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h4>
                    <div class="detail-row">
                        <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</span>
                        <span class="detail-value">${order.id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©</span>
                        <span class="detail-value"><span class="order-badge ${order.status}">${getOrderStatusText(order.status)}</span></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
                        <span class="detail-value">${new Date(order.createdAt).toLocaleString('ar-SA')}</span>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4><i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ø§Ø³Ù…</span>
                        <span class="detail-value">${order.customerName}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ù‡Ø§ØªÙ</span>
                        <span class="detail-value">${order.customerPhone}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span>
                        <span class="detail-value">${order.shippingAddress}</span>
                    </div>
                    ${order.shippingCity ? `
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span>
                        <span class="detail-value">${order.shippingCity}</span>
                    </div>
                    ` : ''}
                </div>
                
                <div class="detail-section">
                    <h4><i class="fas fa-box"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
                    <div class="items-list">
                        ${itemsHTML}
                        <div class="total-row">
                            <span class="total-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                            <span class="total-value">${order.total.toLocaleString()} Ø¯Ø¬</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Show/hide action buttons
            document.getElementById('modalCancelBtn').style.display = ['pending', 'processing'].includes(order.status) ? 'block' : 'none';
            document.getElementById('modalShipBtn').style.display = order.status === 'processing' ? 'block' : 'none';
            document.getElementById('modalDeliverBtn').style.display = order.status === 'shipped' ? 'block' : 'none';
            
            document.getElementById('orderModal').classList.add('show');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('show');
            selectedOrder = null;
        }

        function updateOrderStatus(orderId, newStatus) {
            const orderIndex = allOrders.findIndex(o => o.id === orderId);
            if (orderIndex !== -1) {
                allOrders[orderIndex].status = newStatus;
                allOrders[orderIndex].updatedAt = new Date().toISOString();
                saveOrders();
                renderOrders();
                updateOrdersStats();
                showToast(`ØªÙ… ${newStatus === 'processing' ? 'Ø¨Ø¯Ø¡ ØªØ­Ø¶ÙŠØ±' : newStatus === 'shipped' ? 'ØªØ£ÙƒÙŠØ¯ Ø´Ø­Ù†' : newStatus === 'delivered' ? 'ØªØ£ÙƒÙŠØ¯ ØªÙˆØµÙŠÙ„' : 'Ø¥Ù„ØºØ§Ø¡'} Ø§Ù„Ø·Ù„Ø¨`, 'success');
            }
        }

        function cancelOrder(orderId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
            updateOrderStatus(orderId, 'cancelled');
        }

        function cancelOrderFromModal() {
            if (selectedOrder) {
                cancelOrder(selectedOrder.id);
                closeOrderModal();
            }
        }

        function shipOrderFromModal() {
            if (selectedOrder) {
                updateOrderStatus(selectedOrder.id, 'shipped');
                closeOrderModal();
            }
        }

        function deliverOrderFromModal() {
            if (selectedOrder) {
                updateOrderStatus(selectedOrder.id, 'delivered');
                closeOrderModal();
            }
        }

        // ===============================
        // Customers Section
        // ===============================
        function renderCustomers() {
            const tbody = document.getElementById('customersTableBody');
            const emptyState = document.getElementById('customersEmptyState');
            
            if (!tbody) return;
            
            if (filteredCustomers.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tbody.innerHTML = filteredCustomers.map(customer => {
                const initials = (customer.firstName?.[0] || '') + (customer.lastName?.[0] || '');
                const registrationDate = new Date(customer.createdAt).toLocaleDateString('ar-SA');
                const isActive = customer.ordersCount > 0;
                const customerOrders = allOrders.filter(o => o.customerId === customer.id && o.status !== 'cancelled');
                const customerTotal = customerOrders.reduce((sum, o) => sum + o.total, 0);
                
                return `<tr>
                    <td>
                        <div class="customer-info">
                            <div class="customer-avatar">${initials.toUpperCase()}</div>
                            <div class="customer-details">
                                <span class="customer-name">${customer.fullName}</span>
                                <span class="customer-email">${customer.email}</span>
                            </div>
                        </div>
                    </td>
                    <td>${customer.phone}</td>
                    <td><strong>${customer.ordersCount || 0}</strong></td>
                    <td><strong>${customerTotal.toLocaleString()}</strong> Ø¯Ø¬</td>
                    <td><span class="badge-cell ${isActive ? 'badge-active' : 'badge-inactive'}">${isActive ? 'Ù†Ø´Ø·' : 'Ø¬Ø¯ÙŠØ¯'}</span></td>
                    <td>${registrationDate}</td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn btn-view" onclick="viewCustomerDetails(${customer.id})" title="Ø¹Ø±Ø¶">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-ship" onclick="viewCustomerOrders(${customer.id})" title="Ø§Ù„Ø·Ù„Ø¨Ø§Øª">
                                <i class="fas fa-shopping-bag"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }

        function filterCustomers() {
            const search = document.getElementById('customerSearch').value.toLowerCase();
            const status = document.getElementById('customerStatusFilter').value;
            
            filteredCustomers = allCustomers.filter(customer => {
                if (search) {
                    const name = (customer.fullName || '').toLowerCase();
                    const email = (customer.email || '').toLowerCase();
                    const phone = (customer.phone || '').toLowerCase();
                    if (!name.includes(search) && !email.includes(search) && !phone.includes(search)) {
                        return false;
                    }
                }
                
                if (status) {
                    const isActive = customer.ordersCount > 0;
                    if (status === 'active' && !isActive) return false;
                    if (status === 'inactive' && isActive) return false;
                }
                
                return true;
            });
            
            renderCustomers();
        }

        function updateCustomersStats() {
            const totalCustomers = allCustomers.length;
            const activeCustomers = allCustomers.filter(c => c.ordersCount > 0).length;
            const totalOrders = allOrders.length;
            const totalSales = allOrders.filter(o => o.status !== 'cancelled').reduce((sum, o) => sum + o.total, 0);
            
            document.getElementById('totalCustomers').textContent = totalCustomers;
            document.getElementById('activeCustomers').textContent = activeCustomers;
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalSales').textContent = totalSales.toLocaleString();
            document.getElementById('customersCount').textContent = totalCustomers;
            
            filteredCustomers = [...allCustomers].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }

        function viewCustomerDetails(customerId) {
            const customer = allCustomers.find(c => c.id === customerId);
            if (!customer) return;
            
            const customerOrders = allOrders.filter(o => o.customerId === customerId);
            const customerTotal = customerOrders.filter(o => o.status !== 'cancelled').reduce((sum, o) => sum + o.total, 0);
            
            alert(`Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:
            
Ø§Ù„Ø§Ø³Ù…: ${customer.fullName}
Ø§Ù„Ø¨Ø±ÙŠØ¯: ${customer.email}
Ø§Ù„Ù‡Ø§ØªÙ: ${customer.phone}
${customer.address ? 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ' + customer.address : ''}
${customer.city ? 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ' + customer.city : ''}

Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${customer.ordersCount || 0}
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª: ${customerTotal.toLocaleString()} Ø¯Ø¬
Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡: ${customer.loyaltyPoints || 0}

Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(customer.createdAt).toLocaleString('ar-SA')}`);
        }

        function viewCustomerOrders(customerId) {
            const customerOrders = allOrders.filter(o => o.customerId === customerId);
            
            if (customerOrders.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„');
                return;
            }
            
            const ordersList = customerOrders.map(order => {
                const statusText = getOrderStatusText(order.status);
                return `Ø·Ù„Ø¨ #${order.id} - ${new Date(order.createdAt).toLocaleDateString('ar-SA')} - ${order.total.toLocaleString()} Ø¯Ø¬ - ${statusText}`;
            }).join('\n');
            
            alert(`Ø§Ù„Ø·Ù„Ø¨Ø§Øª (${customerOrders.length}):\n\n${ordersList}`);
        }

        // ===============================
        // Messages Section
        // ===============================
        function filterMessages(filter, btn) {
            currentMessageFilter = filter;
            
            document.querySelectorAll('.message-filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            renderMessages();
        }

        function renderMessages() {
            const messagesList = document.getElementById('messagesList');
            const emptyState = document.getElementById('messagesEmptyState');
            
            if (!messagesList) return;
            
            let filteredMessages = [...allMessages];
            if (currentMessageFilter === 'unread') {
                filteredMessages = allMessages.filter(m => !m.read);
            } else if (currentMessageFilter === 'read') {
                filteredMessages = allMessages.filter(m => m.read);
            }
            
            filteredMessages.sort((a, b) => new Date(b.createdAt || b.created_at) - new Date(a.createdAt || a.created_at));
            
            if (filteredMessages.length === 0) {
                messagesList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            messagesList.innerHTML = filteredMessages.map(message => {
                const initials = (message.name || 'Ù…').charAt(0).toUpperCase();
                const date = new Date(message.createdAt || message.created_at).toLocaleString('ar-SA');
                const isRead = message.read;
                
                return `
                    <div class="message-card ${isRead ? 'read' : 'unread'}">
                        <div class="message-header">
                            <div class="message-sender">
                                <div class="sender-avatar">${initials}</div>
                                <div class="sender-info">
                                    <h4>${message.name}</h4>
                                    <p>${message.email} â€¢ ${message.phone || 'Ø¨Ø¯ÙˆÙ† Ù‡Ø§ØªÙ'}</p>
                                </div>
                            </div>
                            <div class="message-meta">
                                <div class="message-date">${date}</div>
                                <span class="message-status ${isRead ? 'read' : 'unread'}">${isRead ? 'Ù…Ù‚Ø±ÙˆØ¡' : 'ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡'}</span>
                            </div>
                        </div>
                        <div class="message-body">
                            <div class="message-subject">
                                <i class="fas fa-envelope"></i>
                                ${message.subject || 'Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ¶ÙˆØ¹'}
                            </div>
                            <div class="message-content">${message.message}</div>
                        </div>
                        <div class="message-actions">
                            <button class="action-btn btn-process" onclick="replyToMessage('${message.email}')">
                                <i class="fas fa-reply"></i> Ø±Ø¯
                            </button>
                            <button class="action-btn ${isRead ? 'btn-view' : 'btn-ship'}" onclick="toggleMessageRead(${message.id})">
                                <i class="fas ${isRead ? 'fa-envelope' : 'fa-check'}"></i>
                                ${isRead ? 'ØªØ¹ÙŠÙŠÙ† ÙƒÙ…Ù‚Ø±ÙˆØ¡' : 'ØªØ¹ÙŠÙŠÙ† ÙƒØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡'}
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteMessage(${message.id})">
                                <i class="fas fa-trash"></i> Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMessagesStats() {
            const totalMessages = allMessages.length;
            const unreadMessages = allMessages.filter(m => !m.read).length;
            const readMessages = allMessages.filter(m => m.read).length;
            
            document.getElementById('totalMessages').textContent = totalMessages;
            document.getElementById('unreadMessages').textContent = unreadMessages;
            document.getElementById('readMessages').textContent = readMessages;
            document.getElementById('unreadMessagesCount').textContent = unreadMessages;
        }

        function toggleMessageRead(messageId) {
            const messageIndex = allMessages.findIndex(m => m.id === messageId);
            if (messageIndex !== -1) {
                allMessages[messageIndex].read = !allMessages[messageIndex].read;
                localStorage.setItem(MESSAGES_KEY, JSON.stringify(allMessages));
                renderMessages();
                updateMessagesStats();
                showToast(allMessages[messageIndex].read ? 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©' : 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©', 'success');
            }
        }

        function replyToMessage(email) {
            window.open(`mailto:${email}`, '_blank');
        }

        function deleteMessage(messageId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) return;
            
            allMessages = allMessages.filter(m => m.id !== messageId);
            localStorage.setItem(MESSAGES_KEY, JSON.stringify(allMessages));
            renderMessages();
            updateMessagesStats();
            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // ===============================
        // Utility Functions
        // ===============================
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('adminToast');
            const msgEl = document.getElementById('toastMessage');
            if (toast && msgEl) {
                msgEl.textContent = message;
                toast.className = 'admin-toast ' + type + ' show';
                setTimeout(() => {
                    toast.className = 'admin-toast';
                }, 3000);
            }
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('kbMedicCart') || '[]');
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
                cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            }
        }

        function toggleAdminLanguage() {
            currentLang = currentLang === 'ar' ? 'fr' : 'ar';
            localStorage.setItem('kbMedicLanguage', currentLang);
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            renderProductsTable();
        }

        // Close modal on outside click
        document.getElementById('orderModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeOrderModal();
            }
        });
    </script>
</body>
</html>
